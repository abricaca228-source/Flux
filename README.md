## Flux — чат как Discord/Telegram

### 1. Что это

Минимальный клон Discord/Telegram:
- регистрация и логин с хешированием пароля (Argon2);
- профили с аватаром, обоями, био, городом, датой рождения и ссылками;
- личные чаты и группы, система заявок в друзья;
- сообщения с ответами, редактированием, удалением, реакциями;
- медиа: картинки, файлы, голосовые сообщения;
- «spy»‑сообщения, которые исчезают после просмотра;
- WebRTC‑звонки между пользователями;
- поиск по истории чата.

Бэкенд — FastAPI + PostgreSQL (asyncpg), фронтенд — чистый HTML/CSS/JS.

---

### 2. Подготовка PostgreSQL (через PgAdmin 4)

1. Запусти PgAdmin 4 и зайди на свой сервер PostgreSQL.
2. Создай базу данных:
   - Name: `flux_db`
   - Owner: пользователь `postgres` (или тот, что у тебя настроен).
3. Если у тебя другие логин/пароль/порт или другая БД:
   - либо измени переменную окружения `DATABASE_URL`,
   - либо поправь строку по умолчанию в `database.py`:
     `postgresql+asyncpg://USER:PASSWORD@HOST:PORT/DBNAME`.

Пример `DATABASE_URL`:

```bash
export DATABASE_URL="postgresql+asyncpg://postgres:postgres@localhost:5432/flux_db"
```

---

### 3. Установка зависимостей

В каталоге проекта:

```bash
python3 -m venv venv
./venv/bin/pip install -r requirements.txt
```

(В Windows команды для виртуального окружения будут другими.)

---

### 4. Запуск сервера

В корне проекта:

```bash
./venv/bin/uvicorn main:app --reload
```

По умолчанию приложение поднимается на `http://127.0.0.1:8000`.

При старте:
- выполняется `init_db()` из `database.py`, которое:
  - создаёт таблицы `users`, `messages`, `dms`, `friend_requests`, `groups`, `group_members`, если их нет;
  - аккуратно добавляет недостающие колонки, если база была создана более старой версией кода.

---

### 5. Где фронтенд

- Основной интерфейс чата: `templates/index.html` — отдаётся по `/`.
- Статические файлы (иконки, манифест PWA): каталог `static/`.

Если хочешь менять внешний вид — редактируй стили и скрипты внутри `templates/index.html` (структура уже настроена под layout в стиле Discord/Telegram).

---

### 6. Полезное

- Если Uvicorn пишет `Address already in use`, значит сервер уже запущен на этом порту — просто открой вкладку браузера на `http://127.0.0.1:8000` или останови старый процесс.
- Если при старте получаешь ошибку соединения с БД — проверь:
  - что PostgreSQL запущен;
  - что база `flux_db` существует;
  - что `DATABASE_URL` указывает на правильные логин/пароль/порт.

